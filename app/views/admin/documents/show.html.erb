<div class="page-header"><h1>Edit Document</h1></div>

<h2 class="document_name" id="document_name"><%= @document.name %></h2>
<h3 class="last-edited">Last edited <strong><%= time_ago_in_words(@document.updated_at) %> ago</strong> by <strong>Charlie Melbye</strong></h3>
<h3 class="last-edited last"><a href="#">View document information &raquo;</a></h3>

<%= form_for [:admin, @document] do |f| %>
	<div class="tabbable">
		<div class="wmd-button-bar-wrapper">
			<div id="wmd-button-bar">
				<div class="pull-right">
					<div class="btn-toolbar">
						<div class="btn-group">
							<a href="#" class="btn" id="preview-button"><i class="icon-search"></i> Preview</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="tab-pane active" id="edit_document">
			<div class="wmd-panel">
				<div class="wmd-textarea-wrapper">
					<div class="expandingArea">
						<pre><span></span><br></pre>
						<%= f.text_area :body, :id => "wmd-input" %>
					</div>
				</div>
			</div>
		</div>
		<div class="tab-pane" id="preview_document">
			<div class="wmd-preview-wrapper"><div id="wmd-preview" class="wmd-panel wmd-preview"></div></div>
		</div>

		<div class="form-actions">
			<button type="submit" class="btn btn-primary">Save Document</button>
			<%= link_to "Cancel", admin_documents_path, :class => "btn", :confirm => "Are you sure? Your changes will not be saved." %>
		</div>
	</div>
<% end %>

<div class="modal fade" id="renameModal">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">Ã—</a>
		<h3>Rename Document</h3>
	</div>
	<div class="modal-body">
		<%= form_for [:admin, @document] do |f| -%>
		<div class="control-group">
			<%= f.label :name, :class => "control-label" %>
			<div class="controls">
				<%= f.text_field :name, :class => "input-xlarge" %>
				<p class="help-block">Please provide a descriptive name so others know what your document is.</p>
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<button type="submit" class="btn btn-primary">Rename</button>
		<a href="#" class="btn" data-dismiss="modal">Cancel</a>
		<% end %>
	</div>
</div>

<link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
<style>
h2.document_name {
}

h2.document_name:hover {
	background-color: lightYellow;
	cursor: pointer;
}

h3.last-edited {
	font-weight: normal;
}

h3.last {
	margin-bottom: 20px;
}

.tab-pane {
	display: none;
}

.tab-pane.active {
	display: block;
}

.expandingArea {
	width: 600px;
	background-color: #666;
	border-left: 1px solid #999;
	border-right: 1px solid #999;
	margin-left: 20px;
	min-height: 250px;
}

.expandingArea > pre,
.expandingArea > textarea {
	width: 600px;
	font-family: 'Inconsolata', monospace;
	border: none;
	box-shadow: none;
	-webkit-box-shadow: none;
	-moz-box-shadow: none;
	color: #fff;
	font-size: 12pt;
}

.wmd-textarea-wrapper {
	background-color: #555;
}

.expandingArea > textarea:focus {
	border: none;
	box-shadow: none;
	-webkit-box-shadow: none;
	-moz-box-shadow: none;
}

.wmd-panel {
}

.wmd-preview-wrapper {
	background-color: #f8f8f8;
	padding-left: 20px;
}

.wmd-preview {
	padding: 10px 3px;
	width: 600px;
}

.form-actions {
	margin-top: 0;
	border-bottom: 1px solid #ddd;
}

.modal {
	display: none;
}

.wmd-button-bar-wrapper {
	background-color: whiteSmoke;
	border-top: 1px solid #ddd;
	border-bottom: 1px solid #DDD;
	padding-top: 1px;
	padding-left: 20px;
	padding-right: 20px;
}
#wmd-button-bar {
	width: 600px;
}
#wmd-button-bar .btn-toolbar {
	margin: 7px 0 4px 0;
}
#wmd-button-bar .pull-right .btn-toolbar {
	margin: 0;
}
</style>

<% content_for :js do %>
<script>
$(function() {
	var converter = Markdown.getSanitizingConverter();
	var editor = new Markdown.Editor(converter);
	editor.run();

	$("#renameModal").modal('hide');

	$("#document_name").click(function() {
		$("#renameModal").modal('show');
	});

	$("#preview-button").data('showing-preview', false);

	$("#preview-button").click(function (e) {
		e.preventDefault();

		$(this).button('toggle');

		if($(this).data("showing-preview") == false) {
			$('#edit_document').removeClass('active');
			$('#preview_document').addClass('active');
			$(this).data("showing-preview", true);
		} else {
			$('#edit_document').addClass('active');
			$('#preview_document').removeClass('active');
			$(this).data("showing-preview", false);
		}
	});

	$('.expandingArea').expandElegantly();
});
</script>
<% end %>